<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./style.css" />
  <link rel="icon" type="image/x-icon" href="https://tse1-mm.cn.bing.net/th/id/OIP-C.lU4kOMw5lwhBp2-8nT0t0QHaH-?rs=1&pid=ImgDetMain" />
  <title>Market</title>
</head>
<div id="header-placeholder"></div>
<h1 class="center">Welcome to the Market!</h1>
<a href="./home.html">
  <img src="images/cow.jpg" alt="logo" width="150" height="150" class="img" />
</a>

<!--Account Dashboard-->
<div class="grid-display">
  <div class="grid-item">
    <p class="grid-title">Available Coins</p>
  </div>
  <div class="grid-item">
    <p class="grid-title">Today's Income</p>
  </div>
  <div class="grid-item">
    <p class="grid-title">Today's Losses</p>
  </div>
  <div class="grid-item">
    <p class="grid-title">Auto Earning <a href="autoearn.html"><img src="images/question.png" alt="auto earn" width="20"
          height="20" /></a></p>
  </div>
  <!--Avaiable Coins-->
  <div class="grid-item">
    <p class="coins"></p>
  </div>
  <!--Income-->
  <div class="grid-item">
    <p class="income"></p>
  </div>
  <!--Losses-->
  <div class="grid-item">
    <p class="losses"></p>
  </div>
  <!--Auto Earn-->
  <div class="grid-item">
    <p class="auto"></p>
  </div>
</div>
<!--Navbar-->
<nav class="navbar">
  <a href="./world.html" aria-label="World">
    <span class="emoji">🌍</span>
    <span class="full-text">World</span>
  </a>
  <a href="./map.html" class="active" aria-label="Map">
      <span class="emoji">🗺️</span>
    <span class="full-text">Map</span>
  </a>
  <a href="./life.html" aria-label="Map">
      <span class="emoji">👨‍🌾</span>
    <span class="full-text">Life</span>
  </a>
  <a href="./job.html" aria-label="Job">
        <span class="emoji">💼</span>
    <span class="full-text">Job</span>
  </a>
  <a href="./expenses.html" aria-label="Expenses">
    <span class="emoji">🧾</span>
    <span class="full-text">Expenses</span>
  </a>
  <a href="./purchase.html" aria-label="Purchase">
    <span class="emoji">🛒</span>
    <span class="full-text">Purchase</span>
  </a>
</nav>
<br>
<div class="dropwdown">
  <!-- sustenancesustenancesustenancesustenancesustenancesustenancesustenancesustenancesustenance -->
  <button class="dropdownTitle" onclick="reveal('sustenance')">
    <h3 class="heading"><b>Food (per day)</b></h3>
  </button>
  <div class="dropdownText" id="sustenance" style="display: none">
    <div class="earn-display">
      <div class="grid-tile">
        <div class="tile-title">Basic Food<div class="subtitle">(1 M³)</div></div>
        <div class="tile-content">
          *Required to survive*<br> Includes bread, porridge, bland vegetables, few meat
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Standard Food<div class="subtitle">(2 M³)</div></div>
        <div class="tile-content">
          Better than basic food<br>
          Includes soft bread, porridge, better vegetables, meat (beef, pork, chicken), and drink per day.
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Premium Food<div class="subtitle">(5 M³)</div></div>
        <div class="tile-content">
          Best food option<br>
          <br> Includes baked goods, porridge, fresh vegetables, premium meat (beef, pork, chicken, fish), spices and ale.
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Ale<div class="subtitle">(3 M³)</div></div>
        <div class="tile-content">
          Ale / Apple Cider / Other drinks
        </div>
      </div>
    </div>
  </div>
  <br>
  <br>
</div>

<div class="dropwdown">
  <!-- COWS -->
  <button class="dropdownTitle" onclick="reveal('dropped')">
    <h3 class="heading"><b>Cows</b></h3>
  </button>
  <div class="dropdownText" id="dropped" style="display: none">
    <div class="earn-display">
      <div class="grid-tile">
        <div class="tile-title">Upgrade Your Cow<div class="subtitle">200 M³</div></div>
        <div class="tile-content">
          Upgrade your cow so it can earn 3-5 M³ / day <br>
          Amount depends on the condition of your cow
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Cows<div class="subtitle"><span id="cowPrice"></span></div></div>
        <div class="tile-content">
          1 M³ /day <br>
          *Required for bulls and cattle*
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Cattles<div class="subtitle"><span id="cattlePrice"></span></div></div>
        <div class="tile-content">
          5 M³ /day
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Bulls<div class="subtitle"><span id="bullPrice"></span></div></div>
        <div class="tile-content">
          100 M³ /day <br>
          *Bull Arena <span id="arenaPrice"></span> and Bull Facilities/Services (250 M³ / bull) required* <br>
          Max: 3 bulls
        </div>
      </div>
    </div>
  </div>
  <br><br>
</div>

<div class="dropwdown">
  <!-- LIVESTOCK -->
  <button class="dropdownTitle" onclick="reveal('Livestock')">
    <h3 class="heading"><b>Livestock</b></h3>
  </button>
  <div class="dropdownText" id="Livestock" style="display: none">
    <div class="earn-display">
      <div class="grid-tile">
        <div class="tile-title">Horse<div class="subtitle"><span id="horsePrice"></span></div></div>
        <div class="tile-content">
          Horses are most commonly used for transportation. They can be ridden or used to pull wagons and carts.
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Sheep<div class="subtitle"><span id="sheepPrice"></span></div></div>
        <div class="tile-content">
          3 M³ /day <br>
          Sheep wool can be sold, and sheep can be used for meat.
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Chicken and Rooster<div class="subtitle"><span id="chickenPrice"></span></div></div>
        <div class="tile-content">
          <b>Chickens: </b>1 M³ /day<br>
          Chicken lay eggs, while roosters enable chicken to reproduce.<br>
          Odd are male, even are female.
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Pig<div class="subtitle"><span id="pigPrice"></span></div></div>
        <div class="tile-content">
          3 M³ /day <br>
          Pigs can be sold for pork.
        </div>
      </div>
    </div>
  </div>
  <br><br>
</div>

<div class="dropwdown">
  <!-- CROPS -->
  <button class="dropdownTitle" onclick="reveal('crops')">
    <h3 class="heading"><b>Crops (per plot)</b></h3>
  </button>
  <div class="dropdownText" id="crops" style="display: none">
    <div class="earn-display">
      <div class="grid-tile">
        <div class="tile-title">Carrots<div class="subtitle">(15 M³)</div></div>
        <div class="tile-content">
          <b>Earns: </b> 2 M³ / day<br>
          <b>Water Usage: </b> 2 buckets / day<br>
          <b>Farm Time:</b> 0.5 hr / day
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Beans<div class="subtitle">(20 M³)</div></div>
        <div class="tile-content">
          <b>Earns: </b> 2 M³ / day<br>
          <b>Water Usage: </b> 1 bucket / day<br>
          <b>Farm Time:</b> 0.75 hr / day
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Cabbage<div class="subtitle">(30 M³)</div></div>
        <div class="tile-content">
          <b>Earns: </b> 3 M³ / day<br>
          <b>Water Usage: </b> 2 buckets / day<br>
          <b>Farm Time:</b> 1 hr / day
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Onions<div class="subtitle">(40 M³)</div></div>
        <div class="tile-content">
          <b>Earns: </b> 4 M³ / day<br>
          <b>Water Usage: </b> 1 bucket / day<br>
          <b>Farm Time:</b> 1.5 hr / day
        </div>
      </div>
    </div>
    <div class="earn-display">
      <div class="grid-tile">
        <div class="tile-title">Wheat<div class="subtitle">(50 M³)</div></div>
        <div class="tile-content">
          <b>Earns: </b> 6 M³ / day<br>
          <b>Water Usage: </b> 2 buckets / day<br>
          <b>Farm Time:</b> 1.75 hr / day<br>
          Can be processed into flour (11 M³) with a mill.
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Corn<div class="subtitle">(60 M³)</div></div>
        <div class="tile-content">
          <b>Earns: </b> 10 M³ / day<br>
          <b>Water Usage: </b> 3 buckets / day<br>
          <b>Farm Time:</b> 2 hr / day<br>
          Can be processed into cornmeal (17 M³) with a mill.
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Cotton<div class="subtitle">(100 M³)</div></div>
        <div class="tile-content">
          <b>Earns: </b> 20 M³ / day<br>
          <b>Water Usage: </b> 5 buckets / day <br>
          <b>Farm Time:</b> 2-4 hr / day <br>
          Requires cotton gin processing to sell.
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Soil<div class="subtitle">(One Time Purchase)</div></div>
        <div class="tile-content">
          Plus (20 M³): Enables plants to live 1.5 months <br>
          Premium (45 M³): Enables plants to live 2 months
        </div>
      </div>
    </div>
  </div>
  <br><br>
</div>

<div class="dropwdown">
  <!-- TREES -->
  <button class="dropdownTitle" onclick="reveal('trees')">
    <h3 class="heading"><b>Trees</b></h3>
  </button>
  <div class="dropdownText" id="trees" style="display: none">
    <div class="earn-display">
      <div class="grid-tile">
        <div class="tile-title">Fruit Tree<div class="subtitle">(75 M³)</div></div>
        <div class="tile-content">
          <b>Earns: </b> 10 M³ / day<br>
          <b>Water Usage: </b> 3 Buckets / day <br>
          <b>Land: </b> 1 Plot <br>
          <b>Farm Time:</b> 1 hr / day <br>
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Small Magical Tree<div class="subtitle"><span id="smallTreePrice"></span></div></div>
        <div class="tile-content">
          <b>Earns: </b> 20 M³ / day<br>
          <b>Water Usage: </b> 6 Buckets / day<br>
          <b>Land: </b> 2x2 Plots<br>
          <b>Includes:</b> Scary Crow <br>
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Medium Magical Tree<div class="subtitle"><span id="mediumTreePrice"></span></div></div>
        <div class="tile-content">
          <b>Earns: </b> 50 M³ / day<br>
          <b>Water Usage: </b> 10 Buckets / day<br>
          <b>Land: </b> 3x3 Plots<br>
          <b>Includes:</b> Skilled Eagle <br>
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Large Magical Tree<div class="subtitle"><span id="largeTreePrice"></span></div></div>
        <div class="tile-content">
          <b>Earns: </b> 100 M³ / day<br>
          <b>Water Usage: </b> 15 Buckets / day<br>
          <b>Land: </b> 4x4 Plots<br>
          <b>Includes:</b> Wise Owl <br>
        </div>
      </div>
    </div>
  </div>
  <br><br>
</div>

<div class="dropwdown">
  <!-- WEAPONS -->
  <button class="dropdownTitle" onclick="reveal('WEAPONS')">
    <h3 class="heading"><b>Weapons</b></h3>
  </button>
  <div class="dropdownText" id="WEAPONS" style="display: none">
    <div class="earn-display">
      <div class="grid-tile">
        <div class="tile-title">Darts<div class="subtitle">(5 M³)</div></div>
        <div class="tile-content">
          Five darts, useful for hiting short range targets
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Bow and 5 Arrows<div class="subtitle">(15 M³)</div></div>
        <div class="tile-content">
          Useful for long range targets
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Spear<div class="subtitle">(50 M³)</div></div>
        <div class="tile-content">
          Fun to stab people with<br> Stick + Rock
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Sword<div class="subtitle">(150 M³)</div></div>
        <div class="tile-content">
          Metal sword <br>
          Sharper, better than spears
        </div>
      </div>
    </div>
  </div>
  <br><br>
</div>

<div class="dropwdown">
  <!-- TOOLS -->
  <button class="dropdownTitle" onclick="reveal('TOOLS')">
    <h3 class="heading"><b>Tools</b></h3>
  </button>
  <div class="dropdownText" id="TOOLS" style="display: none">
    <div class="earn-display">
      <div class="grid-tile">
        <div class="tile-title">Axe<div class="subtitle">(10 M³)</div></div>
        <div class="tile-content">
          Chop things
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Shovel<div class="subtitle">(10 M³)</div></div>
        <div class="tile-content">
          Dig things
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Hammer<div class="subtitle">(10 M³)</div></div>
        <div class="tile-content">
          Hit things
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Building Stuff<div class="subtitle">(20 M³)</div></div>
        <div class="tile-content">
          Build things
        </div>
      </div>
    </div>
  </div>
  <br><br>
</div>

<div class="dropdown">
  <!-- STALLS -->
  <button class="dropdownTitle" onclick="reveal('stalls')">
    <h3 class="heading"><b>Stalls (per day)</b></h3>
  </button>
  <div class="dropdownText" id="stalls" style="display: none">
    <div class="earn-display">
      <div class="grid-tile">
        <div class="tile-title">Cheap Stalls</div>
        <div class="tile-content">
          *Required to sell goods* <br>
          Normal times, small stall<br>
          <b>5 / hr</b>
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Standard Stalls</div>
        <div class="tile-content">
          Good times, small stall<br>
          <b>10 / hr</b>
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Plus Stalls</div>
        <div class="tile-content">
          Good times, medium stall<br>
          <b>20 / hr</b>
        </div>
      </div>
      <div class="grid-tile">
        <div class="tile-title">Premium Stalls</div>
        <div class="tile-content">
          Good times, large stall<br>
          <b>40 / hr</b>
        </div>
      </div>
    </div>
  </div>
  <br><br>
</div>
<script type="module" src="control.js"></script>
<script type="module" src="script.js"></script>
<script type="module">
  import { updatePrices } from './script.js';

  function handleMissedMidnights() {
    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime(); 
    const lastExecution =
      parseInt(localStorage.getItem("lastMidnightExecution")) || 0;

    // Calculate how many days have passed since the last execution
    const daysMissed = Math.floor(
      (today - lastExecution) / (1000 * 60 * 60 * 24)
    );

    if (daysMissed > 0) {
      console.log(`Missed ${daysMissed} midnights. Applying updates...`);
      for (let i = 0; i < daysMissed; i++) {
        updatePrices(); // Update prices for each missed day
      }
      localStorage.setItem("lastMidnightExecution", today); 
    } else {
      console.log("No missed midnights. Everything is up to date.");
    }
  }

  function checkForMidnight() {
    const now = new Date();
    const midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 0); // Next midnight
    const timeUntilMidnight = (midnight - now) / 1000; // Time until midnight in seconds

    // Check if the current time is within 50 seconds of midnight
    if (timeUntilMidnight <= 30 && timeUntilMidnight >= 0) {
      console.log("It's within 30 seconds of midnight! Running updates...");
      updatePrices(); // Update prices
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime(); // Start of today
      localStorage.setItem("lastMidnightExecution", today); // Update the last execution time
    }
  }

  // Handle missed midnights when the page is loaded
  handleMissedMidnights();

  // Run the check every second
  setInterval(checkForMidnight, 1000); // Check every 1 second
</script>

</html>